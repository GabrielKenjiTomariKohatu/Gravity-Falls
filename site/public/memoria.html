<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gravity Fandom | Jogo da Memória</title>

    <link rel="icon" href="./assets/icom/logo.png">
    <link rel="stylesheet" href="./css/StyleConta.css">
    <link rel="stylesheet" href="./css/StyleMemoria.css">
    <script src="./js/conta.js"></script>
    <script src="./js/memoria.js"></script>
</head>

<body>
    <main>
        <div class="painel">
            <div class="box">
                <div class="imagem-logo">
                    <div class="logo">
                        <img src="./assets/icom/logo.png">
                    </div>
                </div>
                <div class="botao1">
                    <div class="home">
                        <button onclick="home()">HOME</button>
                    </div>
                    <div class="memoria">
                        <button onclick="memoria()">JOGO DA MEMÓRIA</button>
                    </div>
                    <div class="enygma">
                        <button onclick="enygma()">ENIGMA</button>
                    </div>
                    <div class="personagens">
                        <button onclick="personagens()">PERSONAGENS</button>
                    </div>
                    <div class="mural">
                        <button onclick="mural()">Avisos</button>
                    </div>
                    <div class="estatisticas">
                        <button onclick="estatisticas()">ESTATÍSTICAS</button>
                    </div>
                    <div class="exit">
                        <button onclick="logout()">EXIT</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="conteudo" id="section_home">
            <div class="display">
                <div class="titulo-display">
                    <p>Jogo da MEMÓRIA</p>
                </div>
            </div>
            <div class="conteudo-home" id="DivContent">
                <div class="box-home">
                    <form class="login-form">
                        <div class="login__header">
                            <img src="./assets/brain.png" alt="brain icon">
                            <h1>Memory Game</h1>
                        </div>

                        <input type="text" placeholder="Name" class="login__input" id="nick_input">
                        <button onclick="cadastrarNick()" type="submit" class="login__button" disabled>Play</button>
                    </form>
                </div>
            </div>
        </div>
    </main>
</body>

</html>

<script>
    function cadastrarNick() {
        var nickVar = nick_input.value;
        var usuarioVar = sessionStorage.ID_USUARIO;
        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo


        // Enviando o valor da nova input
        fetch("/jogo/cadastrarNick", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nickServer: nickVar,
                usuarioServer: usuarioVar

            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO CadastrarNickj()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    sessionStorage.NICK_USUARIO = json.nick;
                    // sessionStorage.ID_JOGO = json.idJogo;

                });

            } else {

                console.log("Houve um erro ao tentar realizar o login!");

                resposta.text().then(texto => {
                    console.error(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

    // function entrar() {
    //     var emailVar = email_input.value;
    //     var senhaVar = senha_input.value;

    //     if (emailVar == "" || senhaVar == "") {
    //         // cardErro.style.display = "block"
    //         mensagem_erro.innerHTML = "(Mensagem de erro para todos os campos em branco)";
    //         return false;
    //     }
    //     else {
    //         setInterval(sumirMensagem, 5000)
    //     }

    //     console.log("FORM LOGIN: ", emailVar);
    //     console.log("FORM SENHA: ", senhaVar);

    //     fetch("/pontuacao/autenticar", {
    //         method: "POST",
    //         headers: {
    //             "Content-Type": "application/json"
    //         },
    //         body: JSON.stringify({
    //             emailServer: emailVar,
    //             senhaServer: senhaVar
    //         })
    //     }).then(function (resposta) {
    //         console.log("ESTOU NO THEN DO entrar()!")

    //         if (resposta.ok) {
    //             console.log(resposta);

    //             resposta.json().then(json => {
    //                 console.log(json);
    //                 console.log(JSON.stringify(json));

    //                 sessionStorage.EMAIL_USUARIO = json.email;
    //                 sessionStorage.NOME_USUARIO = json.nome;
    //                 sessionStorage.ID_USUARIO = json.id;

    //                 setTimeout(function () {
    //                     window.location = "./Contas.html";
    //                 }, 1000); // apenas para exibir o loading

    //             });

    //         } else {

    //             console.log("Houve um erro ao tentar realizar o login!");

    //             resposta.text().then(texto => {
    //                 console.error(texto);
    //             });
    //         }

    //     }).catch(function (erro) {
    //         console.log(erro);
    //     })

    //     return false;
    // }

//     function cadastrar() {

// //Recupere o valor da nova input pelo nome do id
// // Agora vá para o método fetch logo abaixo
// var nickVar = nick_input.value;
// var usuarioVar = sessionStorage.ID_USUARIO;

// if (nickVar == "") {
//     mensagem_erro.innerHTML = "(Mensagem de erro para todos os campos em branco)";

//     return false;
// }
// else {
//     setInterval(sumirMensagem, 5000)
// }

// // Enviando o valor da nova input
// fetch("/jogo/cadastrarNick", {
//     method: "POST",
//     headers: {
//         "Content-Type": "application/json"
//     },
//     body: JSON.stringify({
//         // crie um atributo que recebe o valor recuperado aqui
//         // Agora vá para o arquivo routes/usuario.js
//         nickServer: nickVar,
//         usuarioServer: usuarioVar
//     })
// }).then(function (resposta) {

//     console.log("resposta: ", resposta);

//     if (resposta.ok) {

//         mensagem_erro.innerHTML = "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

//         limparFormulario();
//     } else {
//         throw ("Houve um erro ao tentar realizar o cadastro!");
//     }
// }).catch(function (resposta) {
//     console.log(`#ERRO: ${resposta}`);
// });

// return false;
// }

    

    const input = document.querySelector('.login__input');
    const button = document.querySelector('.login__button');
    const form = document.querySelector('.login-form');

    const validateInput = ({ target }) => {
        if (target.value.length > 2) {
            button.removeAttribute('disabled');
            return;
        }
        button.setAttribute('disabled', '');
    }
    // Aqui fica onde o nick vai ser inserido
    const handleSubmit = (event) => {
        event.preventDefault();

        localStorage.setItem('nick', input.value);

        window.location = 'cardsmemoria.html';
    }

    input.addEventListener('input', validateInput);
    form.addEventListener('submit', handleSubmit);

</script>